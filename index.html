<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Test</title>
  <!-- <link rel="stylesheet" type="text/css" href="css/style.css"> -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

  <script type="text/javascript" src="https://cs.nyu.edu/~kapp/cs101/processing_on_the_web/processing.js"></script>
  <script src="./js/three.min.js"></script>
  <script src="./js/OrbitControls.js"></script>

  <style type="text/css">
    #processing-canvas {
      width: 800px;
      height: 400px;
      border: 5px solid black;
    }
  </style>
  
  <script src="./js/p5.min.js"></script>
  <script src="./js/design_script.js"></script>

</head>

<body>
  <h1> Navtiles Design Webapp </h1>
  <h4> Tile type </h4>
  <label for="buttons">Select a button:</label>
  <select id="buttons">
    <option value="bump">Bump</option>
    <option value="bars">Bars</option>
    <option value="arrow_1">Arrow 1</option>
    <option value="arrow_2">Arrow 2</option>
    <option value="question">Question</option>
  </select>

  <!-- insert default image here  -->
  <br>
  <div class="row">
    <div class="column">
      <img
        src="https://firebasestorage.googleapis.com/v0/b/navtiles-bccb4.appspot.com/o/default_floorpan.jpeg?alt=media&token=6c871212-b3da-4859-bbb9-14e4abcc2913"
        alt="default floor plan" width=500>
      <br>

      <button id="myBtn">Try it</button>
      <script>
        document.getElementById("myBtn").addEventListener("click", function () {
          keyPressed(event);
        });
      </script>

      <script type="application/processing" data-processing-target="processing-canvas">
    int[][] grid;
    int rows;
    int cols;
    int sq_len = 20;
    color[] tile_color = new color[5];
    int cur_color = 0;
    PImage img;

    void setup(){
     size(800, 400);
     background(255);
     rows = height/sq_len;
     cols = width/sq_len;
     grid = new int[cols][rows];
     grid[1][0] = 1;
     tile_color[0] = color(235, 64, 52); // red
     tile_color[1] = color(255, 221, 28); // yellow
     tile_color[2] = color(142, 235, 49); // green
     tile_color[3] = color(4, 214, 200); // blue
     tile_color[4] = color(199, 135, 255); //violet
     img = loadImage("https://firebasestorage.googleapis.com/v0/b/navtiles-bccb4.appspot.com/o/default_floorpan.jpeg?alt=media&token=6c871212-b3da-4859-bbb9-14e4abcc2913", "jpeg");
    }

    void draw_grid(){
      for (int i = 0; i < rows; i++){
        stroke(245);
        line(0, (i+1)*sq_len, width, (i+1)*sq_len);
      }
      for (int i = 0; i < cols; i++){
        stroke(245);
        line((i+1)*sq_len, 0, (i+1)*sq_len, height);
      }
      for (int r = 0; r < rows; r++){
        for (int c = 0; c < cols; c++){
          if (grid[c][r] != 0) {
            fill(tile_color[grid[c][r] -1]);
            rect(c * sq_len, r * sq_len, sq_len, sq_len);
          }
        }
      }
    }

    int get_pos(int a){
      return floor(a / sq_len) * sq_len;
    }

    void draw_cursor(){
      fill(tile_color[cur_color]);
      noStroke();
      rect(get_pos(mouseX), get_pos(mouseY), sq_len, sq_len);
    }

    void mouseClicked(){
      int row = get_pos(mouseX) / sq_len;
      int col = get_pos(mouseY) / sq_len;
      if (grid[row][col] == 0){
        grid[row][col] = cur_color + 1;
      }
      else{
        grid[row][col] = 0;
      }
    }

    void keyPressed(){
      if (keyCode == LEFT && sq_len > 2){
        sq_len--;
        rows = height/sq_len;
        cols = width/sq_len;
        grid = new int[cols][rows];
      }
      else if (keyCode == RIGHT){
        sq_len++;
        rows = height/sq_len;
        cols = width/sq_len;
        grid = new int[cols][rows];
      }

      if (keyCode == UP){
        cur_color++;
        cur_color %= 5;
      }

    }

    void draw(){
     background(255);
     image(img, 0, 0);
     draw_grid();
     draw_cursor();

    }

  		</script>
    </div>
    <div class="column">
      <div class="container">
        <div class="row">
          <div class="col">
            <canvas id="processing-canvas" width="200" height="100"> </canvas>
          </div>
          <div class="col">
            <canvas id="myCanvas" width="200" height="100"></canvas>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>

    // Set up the scene, camera, and renderer as global variables.
    var scene, camera, renderer;

    init();
    animate();

    // Sets up the scene.
    function init() {

      // Create the scene and set the scene size.
      scene = new THREE.Scene();
      var WIDTH = window.innerWidth,
        HEIGHT = window.innerHeight;

      // Create a renderer and add it to the DOM.
      renderer = new THREE.WebGLRenderer({ antialias: true });
      //renderer.setSize(WIDTH, HEIGHT);
      renderer.setSize(200, 100);
      //container = document.getElementById('container');
      //renderer.setSize($(container).width(), $(container).height());
      //container.appendChild(renderer.domElement);
      document.body.appendChild(renderer.domElement);

      // Create a camera, zoom it out from the model a bit, and add it to the scene.
      camera = new THREE.PerspectiveCamera(45, 2, 0.1, 20000);
      camera.position.set(0, 6, 0);
      scene.add(camera);

      // Create an event listener that resizes the renderer with the browser window.
      window.addEventListener('resize', function () {
        var WIDTH = window.innerWidth,
          HEIGHT = window.innerHeight;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
      });

      // Set the background color of the scene.
      renderer.setClearColorHex(0x333F47, 1);

      // Create a light, set its position, and add it to the scene.
      var light = new THREE.PointLight(0xffffff);
      light.position.set(-100, 200, 100);
      scene.add(light);

      // Load in the mesh and add it to the scene.
      var loader = new THREE.JSONLoader();
      loader.load("models/treehouse_logo.js", function (geometry) {
        var material = new THREE.MeshLambertMaterial({ color: 0x55B663 });
        mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);
      });

      // Add OrbitControls so that we can pan around with the mouse.
      controls = new THREE.OrbitControls(camera, renderer.domElement);

    }

    function resizeCanvasToDisplaySize() {
      const canvas = renderer.domElement;
      // look up the size the canvas is being displayed
      const width = canvas.clientWidth;
      const height = canvas.clientHeight;

      // adjust displayBuffer size to match
      if (canvas.width !== width || canvas.height !== height) {
        // you must pass false here or three.js sadly fights the browser
        renderer.setSize(width, height, false);
        camera.aspect = width / height;
        camera.updateProjectionMatrix();

        // update any render target sizes here
      }
    }

    // Renders the scene and updates the render as needed.
    function animate() {

      // Read more about requestAnimationFrame at http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
      requestAnimationFrame(animate);
      resizeCanvasToDisplaySize();

      // Render the scene.
      renderer.render(scene, camera);
      controls.update();

    }

  </script>



</body>

</html>
